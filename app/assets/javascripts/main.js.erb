function setup_datatable() {
  var height = searchResultsLayout.state.center.innerHeight - 115
  var include_exclude_action = function( nButton, oConfig ) {
            var oTT = TableTools.fnGetInstance('example');
            var data = oTT.fnGetSelectedData();
            if (data.length == 0)
              alert("Nothing selected")
            else
              alert("Including rows: \n" + data.join("\n"))
          }

  table = $('#example').DataTable({
    "serverSide": true,
    "scrollY": height,
    "dom": '<"toolbar"T>iftS',
    "ajax": "index.json",
    "scroller": {
      loadingIndicator: true
    },
    tableTools: {
      "sRowSelect": "os",
      "fnRowSelected": function ( nodes ) {
        var data = table.row(nodes[0]).data()
        $("#details").html("You have selected row with name: " + data[0] + " and salary " + data[1])
      },
      "fnRowDeselected": function ( nodes ) {
        $("#details").html("")
      },
      "aButtons": [
        "select_none",
        {
          "sExtends": "text",
          "sButtonText": "Include",
          "fnClick": include_exclude_action
        },
        {
          "sExtends": "text",
          "sButtonText": "Exclude",
          "fnClick": include_exclude_action
        },
        {
          "sExtends": "text",
          "sButtonText": "Undecide",
          "fnClick": include_exclude_action
        },
        {
          "sExtends": "collection",
          "sButtonText": "Label",
          "aButtons" : [
            {"sExtends": "div", "sButtonText": "label1"},
            {"sExtends": "div", "sButtonText": "label2"},
            {"sExtends": "div", "sButtonText": "New label..."}
          ]
        },
        {
          "sExtends": "collection",
          "sButtonText": "Fetch references",
          "aButtons" : [
            {"sExtends": "div", "sButtonText": "Selected (n)"},
            {"sExtends": "div", "sButtonText": "Filtered (n)"},
            {"sExtends": "div", "sButtonText": "All (n)"}
          ]
        },
        {
          "sExtends": "collection",
          "sButtonText": "Export",
          "aButtons" : [
            {"sExtends": "div", "sButtonText": "RefMan"},
            {"sExtends": "div", "sButtonText": "BibTex"},
            {"sExtends": "div", "sButtonText": "EndNote"},
            {"sExtends": "div", "sButtonText": "CSV"}
          ]
        },
        {
          "sExtends": "text",
          "sButtonText": "New search..."
        },
        {
          "sExtends": "text",
          "sButtonText": "All reviews..."
        },
      ]
    }
  });
}

$(document).ready(function() {
  var pageLayout = $('body').layout({
    applyDefaultStyles: true,
    west__size: "20%",
    west__minSize: "10%",
    west__maxSize: "50%",
    west__onresize: function() {
      table.columns.adjust().draw();
    },
    west__onclose: function() {
      table.columns.adjust().draw();
    }
  });
  
  searchResultsLayout = $("#search_results").layout({
    applyDefaultStyles: true,
    // north__spacing_open: 0,
    south__size: "50%",
    south__minSize: "25%",
    south__maxSize: "75%",
    center__onresize: function() {
      table.destroy()
      setup_datatable()
    }
  });

  setup_datatable()

});
